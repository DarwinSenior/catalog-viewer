<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">

<link rel="import" href="./collapsable-item.html">
<link rel="import" href="./heatmap-picker.html">
<link rel="import" href="./simple-data.html">
<link rel="import" href="./select-color-ui.html">
<link rel="import" href="./filter-ui.html">
<dom-module id="map-controller">
  <style>
    :host {
      display: block;
      width: 100%;
      height: 100%;
      overflow: visible;
    }
    .header-title{
      font-size: 40px;
    }
    .heatmap-picker{
      margin: 5px;
    }
    .data-card{
      background-color: var(--paper-grey-100);
      margin: 10px;
    }
    #slider{
      height: 20px;
    }
  </style>
  <template>
    <paper-toolbar class="medium-tall">
      <paper-icon-button icon="arrow-back" on-tap="_return"></paper-icon-button>
      <div class="title bottom"><span class="header-title">[[title]]</span></div>
    </paper-toolbar>
    <collapsable-item title="Data Display">
      <paper-material class="data-card" elevation="1">
        <simple-data data="[[requiredinfo]]"></simple-data>
      </paper-material>
    </collapsable-item>

    <collapsable-item title="Map Filter Setting">
      <template is="dom-repeat" items="[[_processdata(data)]]">
        <filter-ui
          name="[[item.name]]"
          for="[[item.name]]"
          rangeleft="[[item.min]]"
          rangeright="[[item.max]]"
          disabled="[[!item.isNumber]]">
        </filter-ui>
      </template>      
    </collapsable-item>

    <collapsable-item title="Map Colour Setting">
       <select-color-ui id="colorui" data="[[_processdata(data)]]"></select-color-ui> 
    </collapsable-item>
  </template>
</dom-module>
<script>
(function() {
  Polymer({
    is: 'map-controller',

    properties: {
      title : {
        type : String,
        value : "untitled",
        notify : true
      },
      data : {
        type : Object
      },
      requiredinfo: {
        type : Object
      },
    },
    ready : function(){
    },
    _return : function(){
      this.fire('page-map-return');
    },
    _processdata: function(data){
      var processed_data = [];
      for (key in data){
        if (data[key].type){
          processed_data.push({
            name: key,
            min: data[key].min,
            max: data[key].max,
            isNumber: data[key].type=='FLOAT' || data[key].type=='INT',
          })
        }
      }
      return processed_data;
    },
    _prettyPrint: function(val){
      return (+val).toPrecision(4);
    }
  });
})();
</script>
