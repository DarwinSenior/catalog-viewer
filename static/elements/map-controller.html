<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">

<link rel="import" href="./collapsable-item.html">
<link rel="import" href="./heatmap-picker.html">
<link rel="import" href="./simple-data.html">
<dom-module id="map-controller">
  <style>
    :host {
      display: block;
      width: 100%;
      height: 100%;
      overflow: visible;
    }
    .header-title{
      font-size: 40px;
    }
    .heatmap-picker{
      margin: 5px;
    }
    .data-card{
      background-color: var(--paper-grey-100);
      margin: 10px;
    }
    #slider{
      height: 20px;
    }
  </style>
  <template>
    <paper-toolbar class="medium-tall">
      <paper-icon-button icon="arrow-back" on-tap="_return"></paper-icon-button>
      <div class="title bottom"><span class="header-title">[[title]]</span></div>
    </paper-toolbar>
    <collapsable-item title="Data Display">
      <paper-material class="data-card" elevation="1">
        <simple-data data="[[requiredinfo]]"></simple-data>
      </paper-material>
    </collapsable-item>

    <collapsable-item title="Settings">
    </collapsable-item>

    <collapsable-item title="Colour Map Setting">
        <paper-radio-group selected="{{_selected}}">
        <template is="dom-repeat" items="[[_getColorOptions(data)]]">
          <paper-radio-button class="green" name="[[item.color]]" disabled="[[!item.isNumber]]">[[item.color]]</paper-radio-button>
        </template>
        <div class="layout horizontal" width="100%">
          <span>[[_minVal(_selected)]]</span>
          <paper-double-slider id="slider" class="flex" min="[[_minVal(_selected)]]" max="[[_maxVal(_selected)]]" valuemin="{{_rangeLeft}}" valuemax="{{_rangeRight}}">
          </paper-double-slider>
          <span>[[_maxVal(_selected)]]</span>
        </div>
        </paper-radio-group>
        <heatmap-picker 
          leftcolor="{{_mincolor}}"
          rightcolor="{{_maxcolor}}"></heatmap-picker>
    </collapsable-item>
  </template>
</dom-module>
<script>
(function() {
  Polymer({
    is: 'map-controller',

    properties: {
      title : {
        type : String,
        value : "untitled",
        notify : true
      },
      data : {
        type : Object
      },
      colorscheme : {
        type : Object,
        notify : true,
        // value : {selected : "", maxcolor : 'red', mincolor : 'red'},
        computed : '_colorScheme(_selected, _maxcolor, _mincolor, _rangeLeft, _rangeRight)'
      },
      _maxcolor : {
        type : String,
        notify : true
      },
      _mincolor : {
        type : String,
        notify : true
      },
      _selected : {
        type : String,
        notify : true,
        observer : '_handleSelected'
      },
      _rangeLeft : {
        type : Number,
        notify : true
      },
      _rangeRight : {
        type : Number,
        notify : true
      },
      requiredinfo :{
        type : Object
      }
    },
    ready : function(){
    },
    _return : function(){
      this.fire('page-map-return');
    },
    _colorScheme : function(_selected, _maxcolor, _mincolor, _rangeLeft, _rangeRight){
      console.log('updated');
      return {
        selected: _selected, 
        maxcolor: _maxcolor, 
        mincolor: _mincolor, 
        rangeleft: _rangeLeft,
        rangeright : _rangeRight
      };
    },
    _getColorOptions : function(){
      var data = this.data;
      return (data.HEADER || []).map(function(item){
        return {
          color : item, 
          isNumber : (data[item].type=='INT' || data[item].type=="FLOAT")
        };
      });
    },
    _maxVal : function(_selected){
      return (this.data[_selected].max).toPrecision(4);
    },
    _minVal : function(_selected){
      return (this.data[_selected].min).toPrecision(4);
    },
    _handleSelected : function(_selected){
      this.$.slider.resize();
    }
  });
})();
</script>